<div class="stat-container">

    <div class="in-progress" *ngIf="fetchingStats">
        <mat-spinner [diameter]="50">
        </mat-spinner>
        Fetching stats...
    </div>

    <div *ngIf="profile != undefined && fetchingStats == false; else landingPage">

        <h1> {{ profile.displayName }} <img class="profile-icon" [src]="profile.iconPath"></h1>

        <mat-card-subtitle> Last Updated: {{ profile.dateCreated | date : 'short'}}
        </mat-card-subtitle>

        <!-- <button mat-raised-button [disabled]="profile.mergedStats == undefined" (click)="addProfile(profile)">
            Save
        </button> -->

        <div class="row">
            <div class="column left">
                <app-characters [characters]="profile.characters" [currentId]="currentId"
                    (newCharacterIdEvent)="updateStats($event)">
                </app-characters>
            </div>

            <div class="column right">
                <h2> Stats </h2>

                <!-- <mat-chip-list>
                    <mat-chip (click)="displayedStats=getMode('Merged')" color="accent" selected>All</mat-chip>
                    <mat-chip (click)="displayedStats=getMode('PvE')" color="accent" selected>PvE</mat-chip>
                    <mat-chip (click)="displayedStats=getMode('PvP')" color="accent" selected>PvP</mat-chip>
                </mat-chip-list> -->

                <mat-button-toggle-group [(ngModel)]="currentMode" (change)="displayedStats=getMode(currentMode)">
                    <mat-button-toggle value="Merged">All</mat-button-toggle>
                    <mat-button-toggle value="PvE">PvE</mat-button-toggle>
                    <mat-button-toggle value="PvP">PvP</mat-button-toggle>
                </mat-button-toggle-group>

                <!-- <mat-tab-group mat-align-tabs="center">
                <mat-tab label="Merged">
                    <div class="stat-section"
                        *ngIf="fetchingStats == false && checkEmptyObject(displayedStats) == false">
                        <app-stat-section *ngFor="let section of sections | keyvalue: helper.numberedKeyOrder"
                            [section]="section.value" [sectionName]="section.key"
                            [displayedStats]="getMode('Merged')" [newDisplayedStatsEvent]="newDisplayedStatsEvent">
                        </app-stat-section>
                    </div>
                </mat-tab>
                <mat-tab label="PvE">
                    <div class="stat-section"
                        *ngIf="fetchingStats == false && checkEmptyObject(displayedStats) == false">
                        <app-stat-section *ngFor="let section of sections | keyvalue: helper.numberedKeyOrder"
                            [section]="section.value" [sectionName]="section.key"
                            [displayedStats]="getMode('PvE')" [newDisplayedStatsEvent]="newDisplayedStatsEvent">
                        </app-stat-section>
                    </div>
                </mat-tab>
                <mat-tab label="PvP">
                    <div class="stat-section"
                        *ngIf="fetchingStats == false && checkEmptyObject(displayedStats) == false">
                        <app-stat-section *ngFor="let section of sections | keyvalue: helper.numberedKeyOrder"
                            [section]="section.value" [sectionName]="section.key"
                            [displayedStats]="getMode('PvP')" [newDisplayedStatsEvent]="newDisplayedStatsEvent">
                        </app-stat-section>
                    </div>
                </mat-tab>
            </mat-tab-group> -->

                <div *ngIf="checkEmptyObject(displayedStats) == true">
                    <br>
                    <br>
                    No {{ currentMode }} stats were found
                </div>

                <div class="stat-section" *ngIf="checkEmptyObject(displayedStats) == false">
                    <app-stat-section *ngFor="let section of sections | keyvalue: helper.numberedKeyOrder"
                        [section]="section.value" [sectionName]="section.key" [displayedStats]="displayedStats"
                        [newDisplayedStatsEvent]="newDisplayedStatsEvent">
                    </app-stat-section>
                </div>

            </div>
        </div>
    </div>

    <ng-template #landingPage>
        <ng-container *ngIf="fetchingStats == false">
            <div class="landing-page">
                <div class="landing-page-block">
                    <div class="landing-page-text">
                        <h1>Track your Destiny 2 stats.</h1>
                        <p>
                            See a summary of your Destiny 2 stats, along with 
                            aggregated stats for each of your characters.
                        </p>
                    </div>
    
                    <img src="assets/StatsLandingPage.png" alt="Track your Destiny 2 stats">
                </div>
    
                <div class="landing-page-block">
                    <div class="landing-page-text">
                        <h1>See graph summaries.</h1>
                        <p>
                            Arc Buddy shows you graph summaries for your
                            characters' weapon kills, so you can see 
                            your favored (and least favored) weapons.
                        </p>
                    </div>                
    
                    <img src="assets/GraphLandingPage.png" alt="See graphs of your weapon kills">
                </div>
            </div>            
        </ng-container>
    </ng-template>
</div>