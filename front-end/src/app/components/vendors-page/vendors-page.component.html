<h1 [@inOutAnimation]>Vendors</h1>

<div class="vendors" *ngIf="fetchingVendors == false" [@inOutAnimation]>
    <button mat-button (click)="accordion.openAll()">Expand All</button>
    <button mat-button (click)="accordion.closeAll()">Collapse All</button>

    <mat-accordion multi>
        <mat-expansion-panel class="vendor-group"
            *ngFor="let vendorGroup of vendorGroups | keyvalue: vendorGroupAscOrder" [expanded]="true">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    {{ vendorGroup.key.categoryName }}
                </mat-panel-title>
            </mat-expansion-panel-header>

            <ng-container *ngFor="let vendorMap of vendorGroup.value">
                <div class="vendor-block" *ngFor="let vendor of vendorMap | keyvalue">
                    <img id="vendor-icon" src="https://www.bungie.net{{vendor.key.displayProperties.largeIcon}}" [alt]="vendor.key.displayProperties.name"
                        [title]="vendor.key.displayProperties.name">
                    <div class="vendor-info">
                        <strong>{{ vendor.key.displayProperties.name }}</strong>
                        <small>{{ vendor.key.displayProperties.subtitle }}</small>
                    </div>

                    <div class="vendor-categories">
                        <div class="vendor-category" *ngFor="let category of vendor.value | keyvalue">
                            <h2>{{ category.key }}</h2>
                            <mat-divider></mat-divider>

                            <div class="vendor-items">
                                <div class="vendor-item" id="parent-item" *ngFor="let vendorItem of category.value" 
                                attr.aria-label="{{vendorItem.displayProperties.name.toUpperCase()}}
{{vendorItem.itemTypeDisplayName !== undefined && vendorItem.itemTypeDisplayName.length > 0 ? vendorItem.itemTypeDisplayName : 'Unknown'}}">
                                    <img id="item-icon" *ngIf="vendorItem.displayProperties.hasIcon"
                                        src="https://www.bungie.net{{vendorItem.displayProperties.icon}}"
                                        [alt]="vendorItem.displayProperties.name"
                                        aria-label="Hello there!">
                                        <!-- title="{{vendorItem.displayProperties.name}} &#013;{{vendorItem.itemTypeDisplayName !== undefined && vendorItem.itemTypeDisplayName.length > 0 ? vendorItem.itemTypeDisplayName : 'Unknown'}}"> -->
                                    <!-- <div id="hover-item">Item Info</div> -->
                                    <!-- <span aria-label="This is information">This is a test</span> -->
                                    <p *ngFor="let vendorItemCost of vendorItemCosts.get(vendorItem.hash)"> {{vendorItemCost.quantity }} <img id="cost-icon"
                                            src="https://www.bungie.net{{vendorItemCost.definition.displayProperties.icon}}"
                                            alt="{{vendorItemCost.quantity}} {{vendorItemCost.definition.displayProperties.name}}"
                                            title="{{vendorItemCost.quantity}} {{vendorItemCost.definition.displayProperties.name}}">
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <mat-divider></mat-divider>
            </ng-container>
        </mat-expansion-panel>
    </mat-accordion>
</div>

<div class="in-progress" *ngIf="fetchingVendors && error == false" [@inOutAnimation]>
    <mat-spinner [diameter]="50">
    </mat-spinner>
    Fetching vendors...
</div>

<div class="error" *ngIf="error" [@inOutAnimation]>
    Unable to fetch vendors. Please try again later.
</div>